(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const g of l.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&a(g)}).observe(document,{childList:!0,subtree:!0});function o(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(n){if(n.ep)return;n.ep=!0;const l=o(n);fetch(n.href,l)}})();const r=800,h=600,m=100,k=1,R=-20,v=5,W=15,M=10,U=.5,j=300,A="#FFFFFF",N="#000000",G="#EDC9AF",$="#87CEEB",z="#228B22",J="#145214",q="#B0A18F",Y="#FFD700",S=document.getElementById("gameCanvas"),e=S.getContext("2d");S.width=r;S.height=h;const d=document.getElementById("signInOverlay"),w=document.getElementById("startOverlay");let s="",y=null;const K="https://testnet-rpc.monad.xyz",X=new NetworkWithRpc("monad",10143,K),L=new TldParser(X,"monad"),V="0x09Bfa39480b61A3eaF559fE419626e2367b6d4c7",Q=["function balanceOf(address owner) view returns (uint256)","function tokenOfOwnerByIndex(address owner, uint256 index) view returns (uint256)"];function D(){return JSON.parse(localStorage.getItem("highScoresByUser")||"{}")[s]||[]}function Z(t){const i=JSON.parse(localStorage.getItem("highScoresByUser")||"{}");i[s]=t,localStorage.setItem("highScoresByUser",JSON.stringify(i))}function ee(){d.classList.remove("hidden"),w.classList.add("hidden"),d.innerHTML='<button id="walletBtn">Connect Wallet</button>';const t=document.getElementById("walletBtn");t.onclick=async function(){if(window.ethereum)try{const i=await window.ethereum.request({method:"eth_requestAccounts"});if(i&&i.length>0)if(s=i[0].toLowerCase(),localStorage.setItem("userEmail",s),y=await F(s),await O())d.classList.add("hidden"),w.classList.remove("hidden");else{d.innerHTML='<p style="color:white;">You need a Dangles NFT to play.</p><button id="mintBtn">Mint NFT</button>';const a=document.getElementById("mintBtn");a.onclick=async function(){await mintNFT(),d.classList.add("hidden"),w.classList.remove("hidden")}}}catch{alert("Wallet connection failed.")}else alert("No Ethereum wallet found. Please install MetaMask.")}}function _(){d.classList.add("hidden"),w.classList.remove("hidden"),typeof userEmailSpan<"u"&&(userEmailSpan.textContent=s)}d.innerHTML='<button id="walletBtn">Connect Wallet</button>';const te=document.getElementById("walletBtn");te.onclick=async function(){if(window.ethereum)try{const t=await window.ethereum.request({method:"eth_requestAccounts"});t&&t.length>0&&(s=t[0].toLowerCase(),localStorage.setItem("userEmail",s),y=await F(s),await O()?(d.classList.add("hidden"),w.classList.remove("hidden")):(d.innerHTML='<p style="color:white;">You need a Dangles NFT to play.</p><button id="mintBtn">Mint NFT</button>',document.getElementById("mintBtn").onclick=async function(){await mintNFT(),d.classList.add("hidden"),w.classList.remove("hidden")}))}catch{alert("Wallet connection failed.")}else alert("No Ethereum wallet found. Please install MetaMask.")};typeof window.ethers>"u"&&alert("Ethers.js is not loaded. Please check your script includes.");async function O(){if(!window.ethereum||typeof window.ethers>"u")return console.log("No Ethereum wallet or ethers.js found"),!1;try{const t=new window.ethers.BrowserProvider(window.ethereum),o=await(await t.getSigner()).getAddress();return await new window.ethers.Contract(V,Q,t).balanceOf(o)>0}catch(t){return console.error("Error checking NFT ownership:",t),!1}}async function F(t){try{const i=await L.getAllUserDomainsFromTld(t,".mon");if(i&&i.length>0)return i[0].domain_name+".mon";const o=await L.getAllUserDomainsFromTld(t,".nad");if(o&&o.length>0)return o[0].domain_name+".nad"}catch{}return null}s?/^0x[a-fA-F0-9]{40}$/.test(s)?F(s).then(t=>{y=t,_()}):(y=null,_()):(y=null,ee());let f=D();const T=[{display:"HEE-HAW!",full:"*snort* HEE-HAW! *hoof scrape*",soundFile:"donkey_heehaw.mp3"},{display:"*FLAP*",full:"*whooosh* *flap* *slap*",soundFile:"flap_slap.mp3"},{display:"*THUD*",full:"*THUD* *flop-flop* *SLAP* *jiggle*",soundFile:"thud_flop.mp3"},{display:"*grunt*",full:"*uncomfortable shuffle* *low grunt*",soundFile:"low_grunt.mp3"},{display:"EEE-HAW!",full:"EEE-HAW! *scramble* *flop-flap-flop* *thud*",soundFile:"eee_haw.mp3"},{display:"*bounce*",full:"HEE-HAW! *bounce* *slap-slap* *proud snort*",soundFile:"bounce_slap.mp3"},{display:"*WHOOSH*",full:"*determined grunt* *scrape* *whoosh* *pendulous swinging*",soundFile:"whoosh_swing.mp3"},{display:"*SPLASH*",full:"*splash* *secondary splash* *confused bray*",soundFile:"double_splash.mp3"},{display:"*flapping*",full:"*cautious hee-haw* *gravity-accelerated flapping*",soundFile:"flapping.mp3"},{display:"*SLAP*",full:"*shivering bray* *tighter-than-usual flops*",soundFile:"shiver_flop.mp3"}];function ie(){const t={};return T.forEach(i=>{const o=new Audio(`./sounds/${i.soundFile}`);o.preload="auto",t[i.soundFile]=o}),t}const ne={audioCache:ie(),jumpCounter:0};function le(t,i,o){if(t.jumpCounter||(t.jumpCounter=0),t.jumpCounter++,t.jumpCounter%2!==0)return;const a=T[Math.floor(Math.random()*T.length)],n=new Audio(`./sounds/${a.soundFile}`);n.volume=.7,n.play().catch(()=>{});const l=document.createElement("div");return l.className="jumping-sound-text",l.textContent=a.display,l.dataset.fullSound=a.full,Object.assign(l.style,{position:"absolute",left:`${i}px`,top:`${o}px`,backgroundColor:"rgba(255, 255, 255, 0.8)",padding:"8px 12px",borderRadius:"10px",fontFamily:"Comic Sans MS, cursive",fontSize:"0px",transform:"translate(-50%, -50%)",textAlign:"center",boxShadow:"0 2px 5px rgba(0,0,0,0.2)",zIndex:"1000",transition:"all 0.5s ease-in-out",opacity:"0",border:"2px solid #d4a965",maxWidth:"200px",pointerEvents:"none"}),document.getElementById("game-container").appendChild(l),[{time:0,fontSize:"0px",opacity:0},{time:100,fontSize:"14px",opacity:1},{time:500,fontSize:"24px",opacity:1},{time:1200,fontSize:"24px",opacity:1},{time:1700,fontSize:"10px",opacity:0},{time:2e3,remove:!0}].forEach(u=>{setTimeout(()=>{u.remove?l.remove():(l.style.fontSize=u.fontSize,l.style.opacity=u.opacity)},u.time)}),l}class se{constructor(){this.reset(),this.width=60,this.height=60,this.position={x:this.x,y:this.y}}reset(){this.x=100,this.y=h-m-60,this.velocity=0,this.isJumping=!1,this.jumpCount=0,this.earAngle=0,this.tailAngle=0,this.position={x:this.x,y:this.y}}jump(){this.jumpCount<2&&(this.velocity=R,this.isJumping=!0,this.jumpCount++,le(ne,this.x+this.width/2,this.y-this.height/2))}update(){this.velocity+=k,this.y+=this.velocity,this.position={x:this.x,y:this.y},this.isJumping||this.velocity!==0?(this.earAngle=Math.sin(Date.now()/100)*.3,this.tailAngle=Math.sin(Date.now()/80)*.7):(this.earAngle=0,this.tailAngle=0),this.y>h-m-60&&(this.y=h-m-60,this.velocity=0,this.isJumping=!1,this.jumpCount=0),this.position={x:this.x,y:this.y}}draw(){e.beginPath(),e.ellipse(this.x,this.y+55,35,10,0,0,Math.PI*2),e.fillStyle="rgba(0,0,0,0.18)",e.fill(),e.closePath(),e.save(),e.translate(this.x,this.y),e.beginPath(),e.ellipse(0,25,30,22,0,0,Math.PI*2),e.fillStyle="#8B7D6B",e.fill(),e.closePath(),e.beginPath(),e.ellipse(-10,30,7,4,0,0,Math.PI*2),e.fillStyle="#A89B8C",e.fill(),e.closePath(),e.beginPath(),e.ellipse(12,18,5,3,0,0,Math.PI*2),e.fillStyle="#A89B8C",e.fill(),e.closePath(),e.beginPath(),e.ellipse(0,0,18,15,0,0,Math.PI*2),e.fillStyle="#8B7D6B",e.fill(),e.closePath(),e.save(),e.rotate(-.5+this.earAngle),e.beginPath(),e.ellipse(-10,-18,5,16,0,0,Math.PI*2),e.fillStyle="#A89B8C",e.fill(),e.closePath(),e.restore(),e.save(),e.rotate(.5-this.earAngle),e.beginPath(),e.ellipse(10,-18,5,16,0,0,Math.PI*2),e.fillStyle="#A89B8C",e.fill(),e.closePath(),e.restore(),e.beginPath(),e.arc(-5,-2,2,0,Math.PI*2),e.fillStyle="#222",e.fill(),e.closePath(),e.beginPath(),e.arc(5,-2,2,0,Math.PI*2),e.fillStyle="#222",e.fill(),e.closePath(),e.beginPath(),e.arc(0,4,6,0,Math.PI/2),e.strokeStyle="#222",e.lineWidth=1.5,e.stroke(),e.closePath(),e.save(),e.rotate(this.tailAngle),e.beginPath(),e.moveTo(-28,38),e.lineTo(-38,48),e.lineWidth=4,e.strokeStyle="#A89B8C",e.stroke(),e.closePath(),e.restore(),e.beginPath(),e.moveTo(-15,45),e.lineTo(-15,60),e.moveTo(15,45),e.lineTo(15,60),e.lineWidth=5,e.strokeStyle="#8B7D6B",e.stroke(),e.closePath(),e.restore()}}class oe{constructor(i){this.x=i,this.width=30,this.height=Math.floor(Math.random()*60)+60,this.y=h-m-this.height}update(){this.x-=P}draw(){e.fillStyle=z,e.fillRect(this.x,this.y,this.width,this.height),e.fillStyle=J,e.fillRect(this.x-10,this.y+20,10,25),e.fillRect(this.x+this.width,this.y+30,10,20);for(let i=0;i<6;i++)e.beginPath(),e.moveTo(this.x+Math.random()*this.width,this.y+Math.random()*this.height),e.lineTo(this.x+Math.random()*this.width+3,this.y+Math.random()*this.height+3),e.strokeStyle="#fff",e.lineWidth=1,e.stroke(),e.closePath()}}let x=new se,c=[],p=0,E=!1,P=v;function H(){x.reset(),c=[],p=0,E=!1,P=v,f=D()}function ae(){f.push(p),f.sort((t,i)=>i-t),f=f.slice(0,5),Z(f)}document.addEventListener("keydown",t=>{gameStarted&&(t.code==="Space"&&!E&&x.jump(),t.code==="Escape"&&window.close(),t.code==="Enter"&&E&&H())});function re(t,i){return t.x+30>i.x&&t.x-30<i.x+i.width&&t.y+60>i.y}function ce(t,i,o,a,n,l){e.fillStyle=A,e.fillRect(i,o,a,n),e.strokeStyle=N,e.lineWidth=2,e.strokeRect(i,o,a,n),e.fillStyle=N,e.font="24px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(t,i+a/2,o+n/2),S.addEventListener("click",function g(u){const C=S.getBoundingClientRect(),I=u.clientX-C.left,B=u.clientY-C.top;I>=i&&I<=i+a&&B>=o&&B<=o+n&&(l(),S.removeEventListener("click",g))})}function he(){if(e.fillStyle=A,e.font="24px Arial",e.textAlign="left",e.fillText("High Scores:",r-200,40),f.forEach((t,i)=>{e.fillText(`${i+1}. ${t}`,r-200,70+i*30)}),s){e.font="16px Arial";let t=s;s==="guest"?t="Guest":s.includes("@")?t=s:y?t=y:/^0x[a-fA-F0-9]{40}$/.test(s)&&(t=s.slice(0,6)+"..."+s.slice(-4)),e.fillText(`User: ${t}`,r-200,30)}}function b(){if(!gameStarted){requestAnimationFrame(b);return}e.fillStyle=$,e.fillRect(0,0,r,h),e.beginPath(),e.arc(r-100,100,50,0,Math.PI*2),e.fillStyle=Y,e.fill(),e.closePath(),e.fillStyle=G,e.fillRect(0,h-m,r,m);for(let t=0;t<4;t++)e.beginPath(),e.ellipse(150+t*180,h-m+30,18,8,0,0,Math.PI*2),e.fillStyle=q,e.fill(),e.closePath();if(!E){x.update(),p>0&&p%M===0&&(P=Math.min(W,v+p/M*U)),(c.length===0||c[c.length-1].x<r-j)&&c.push(new oe(r));for(let t=c.length-1;t>=0;t--)c[t].update(),c[t].x<-30&&(c.splice(t,1),p++);for(let t of c)if(re(x,t)){E=!0,ae();break}}x.draw();for(let t of c)t.draw();e.fillStyle=A,e.font="36px Arial",e.textAlign="left",e.fillText(`Score: ${p}`,10,40),e.fillText(`Speed: ${P.toFixed(1)}`,10,80),he(),E&&(e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(0,0,r,h),e.fillStyle=A,e.font="48px Arial",e.textAlign="center",e.fillText("Game Over!",r/2,h/2-50),ce("Restart",r/2-100,h/2,200,50,H)),requestAnimationFrame(b)}document.addEventListener("DOMContentLoaded",function(){b()});
